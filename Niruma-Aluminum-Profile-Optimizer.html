<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niruma Aluminum Profile Optimizer</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Existing jsPDF scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <!-- Add this new library for SVG support -->
    <script src="https://cdn.jsdelivr.net/npm/svg2pdf.js@2.2.1/dist/svg2pdf.min.js"></script>

</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üóèÔ∏è Niruma Aluminum Profile Optimizer</h1>
            <p>Intelligent Cutting with Cost-Aware Algorithm</p>
            <div class="unit-toggle">
                <label>Input Unit:</label>
                <span><strong>inches</strong></span>
                <label class="unit-switch">
                    <input type="checkbox" id="unitToggle" onchange="toggleUnit()">
                    <span class="slider"></span>
                </label>
                <span><strong>mm</strong></span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('input')">üìù Add Windows</button>
            <button class="tab" onclick="showTab('windows')">ü™ü Window List</button>
            <button class="tab" onclick="showTab('formulas')">üßÆ Series Formulas</button>
            <button class="tab" onclick="showTab('stock')">üì¶ Stock Master</button>
            <button class="tab" onclick="showTab('optimize')">‚öôÔ∏è Optimize</button>
            <button class="tab" onclick="showTab('results')">üìä Results</button>
        </div>

        <div id="input" class="tab-content active">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">Add Window Configuration</h2>
            <form id="windowForm" onsubmit="addWindow(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Config ID</label>
                        <input type="text" id="configId" value="W01" required>
                    </div>
                    <div class="form-group">
                        <label>Project Name</label>
                        <input type="text" id="projectName" value="check" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Width <span class="unit-label">(inches)</span></label>
                        <input type="number" id="width" step="0.25" value="65" required>
                    </div>
                    <div class="form-group">
                        <label>Height <span class="unit-label">(inches)</span></label>
                        <input type="number" id="height" step="0.25" value="56" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tracks</label>
                        <select id="tracks" required>
                            <option value="2">2 Tracks</option>
                            <option value="3" selected>3 Tracks</option>
                            <option value="4">4 Tracks</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Glass Shutters (S)</label>
                        <select id="shutters" required>
                            <option value="1">1 Shutter</option>
                            <option value="2">2 Shutters</option>
                            <option value="3" selected>3 Shutters</option>
                            <option value="4">4 Shutters</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mosquito Shutters (MS)</label>
                        <select id="mosquitoShutters" required>
                            <option value="0" selected>0 Mosquito Shutter</option>
                            <option value="1">1 Mosquito Shutter</option>
                            <option value="2">2 Mosquito Shutters</option>
                            <option value="3">3 Mosquito Shutters</option>
                            <option value="4">4 Mosquito Shutters</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Series Type</label>
                        <select id="series" required></select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="description" value="Living Room" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">‚ûï Add Window</button>
                <button type="button" class="btn btn-danger" onclick="clearForm()">üîÑ Clear Form</button>
            </form>
        </div>

        <div id="windows" class="tab-content">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">Window Configurations</h2>
            <div id="windowList" class="window-list"></div>
        </div>

        <div id="formulas" class="tab-content">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">Series Formulas Configuration</h2>
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Formula Variables:</strong> W = Width, H = Height, S = Shutters, T = Tracks, MS = Mosquito
                Shutters
            </div>
            <div id="formulasList"></div>
            <div class="section-header">
                <h3>‚ûï Add New Series / Component</h3>
            </div>
            <form id="newSeriesForm" onsubmit="addNewSeries(event)">
                <div class="form-group">
                    <label>Series Name</label>
                    <input type="text" id="newSeriesName" placeholder="e.g., 1.5" required>
                </div>
                <div class="form-group">
                    <label>Component Name</label>
                    <input type="text" id="newComponentName" placeholder="e.g., 1.5 Handle" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="newComponentDesc" placeholder="e.g., Handles" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantity Formula</label>
                        <input type="text" id="newQtyFormula" placeholder="e.g., 2 or 2*S" required>
                    </div>
                    <div class="form-group">
                        <label>Length Formula</label>
                        <input type="text" id="newLengthFormula" placeholder="e.g., H-1.5" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">‚ûï Add Component</button>
            </form>
        </div>

        <div id="stock" class="tab-content">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">Stock Master Configuration</h2>
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Configure Stock:</strong> Set lengths and costs for optimization
            </div>
            <div class="form-group" style="max-width: 300px;">
                <label>Kerf - Saw Blade Width <span class="unit-label">(inches)</span></label>
                <input type="number" id="kerfGlobal" value="0.125" step="0.001" onchange="updateKerf()">
            </div>
            <div id="stockMasterList"></div>
            <div class="section-header">
                <h3>‚ûï Add New Stock Material</h3>
            </div>
            <form id="newStockForm" onsubmit="addNewStock(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Series</label>
                        <select id="newStockSeries" required></select>
                    </div>
                    <div class="form-group">
                        <label>Material Name</label>
                        <input type="text" id="newStockMaterial" placeholder="e.g., Domal Shutter" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Stock 1 Length <span class="unit-label">(inches)</span></label>
                        <input type="number" id="newStock1" value="141" step="1" required>
                    </div>
                    <div class="form-group">
                        <label>Stock 1 Cost (‚Çπ)</label>
                        <input type="number" id="newStock1Cost" value="100" step="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Stock 2 Length <span class="unit-label">(inches)</span></label>
                        <input type="number" id="newStock2" value="177" step="1" required>
                    </div>
                    <div class="form-group">
                        <label>Stock 2 Cost (‚Çπ)</label>
                        <input type="number" id="newStock2Cost" value="125" step="1">
                    </div>
                </div>
                <button type="submit" class="btn btn-success">‚ûï Add Stock Material</button>
            </form>
        </div>

        <div id="optimize" class="tab-content">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">Run Optimization</h2>
            <div class="optimization-mode">
                <h4>üí∞ Smart Cost Optimization Enabled</h4>
                <p style="margin: 0; color: #555;">
                    ‚úÖ Minimizes material waste<br>
                    ‚úÖ Prefers cost-effective stock combinations<br>
                    ‚úÖ Considers total project cost
                </p>
            </div>
            <div class="project-selector">
                <h3 style="margin-bottom: 15px;">Select Project to Optimize</h3>
                <div class="form-group">
                    <label>Project Name</label>
                    <select id="projectSelector" style="max-width: 400px;">
                        <option value="">-- Select Project --</option>
                    </select>
                </div>
                <p style="margin-top: 10px; color: #856404;">
                    <strong>Selected Project Info:</strong> <span id="projectInfo">No project selected</span>
                </p>
            </div>
            <div style="text-align: center; padding: 40px;">
                <button class="btn btn-success" onclick="runOptimization()"
                    style="font-size: 20px; padding: 20px 50px;">
                    üöÄ RUN SMART OPTIMIZATION
                </button>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="generateQuotation()"
                    style="font-size: 16px; padding: 15px 30px;">
                    üìÑ Generate Quotation
                </button>
                <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Saved Data</button>
            </div>
        </div>

        <div id="results" class="tab-content">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">Optimization Results</h2>
            <div id="resultsContent"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="addComponentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Add New Component</h3>
                <button class="close-btn" onclick="closeAddComponentModal()">&times;</button>
            </div>
            <form id="addComponentForm" onsubmit="saveNewComponent(event)">
                <input type="hidden" id="addComponentSeries">
                <div class="form-group">
                    <label>Component Name</label>
                    <input type="text" id="modalComponentName" placeholder="e.g., Domal Handle" required>
                </div>
                <div class="form-group">
                    <label>Quantity Formula</label>
                    <input type="text" id="modalComponentQty" placeholder="e.g., 2*S or 4" required>
                    <small style="color: #7f8c8d;">Use variables: W (width), H (height), S (shutters), MS
                        (mosquito)</small>
                </div>
                <div class="form-group">
                    <label>Length Formula</label>
                    <input type="text" id="modalComponentLength" placeholder="e.g., H-2.75 or W/2" required>
                    <small style="color: #7f8c8d;">Use variables: W (width), H (height), S (shutters)</small>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="modalComponentDesc" placeholder="e.g., Side Handle" required>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeAddComponentModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Component</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editWindowModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Window</h3>
                <button class="close-btn" onclick="closeEditWindowModal()">&times;</button>
            </div>
            <form id="editWindowForm" onsubmit="saveWindowEdit(event)">
                <input type="hidden" id="editWindowIndex">
                <div class="form-row">
                    <div class="form-group">
                        <label>Config ID</label>
                        <input type="text" id="editConfigId" required>
                    </div>
                    <div class="form-group">
                        <label>Project Name</label>
                        <input type="text" id="editProjectName" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Width <span class="unit-label">(inches)</span></label>
                        <input type="number" id="editWidth" step="0.25" required>
                    </div>
                    <div class="form-group">
                        <label>Height <span class="unit-label">(inches)</span></label>
                        <input type="number" id="editHeight" step="0.25" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tracks</label>
                        <select id="editTracks" required>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Shutters</label>
                        <select id="editShutters" required>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mosquito</label>
                        <select id="editMosquitoShutters" required>
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Series</label>
                        <select id="editSeries" required></select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="editDescription" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">üíæ Save Changes</button>
                <button type="button" class="btn btn-danger" onclick="closeEditWindowModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Action</h3>
                <button class="close-btn" onclick="closeConfirmModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 10px 20px; color: #333;">
                <p id="confirmModalMessage">Are you sure?</p>
            </div>
            <div class="modal-footer" style="text-align: right; padding: 12px 20px;">
                <button class="btn btn-secondary" id="confirmCancelBtn">Cancel</button>
                <button class="btn btn-danger" id="confirmOkBtn">Confirm</button>
            </div>
        </div>
    </div>

    <div id="editFormulaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Formula</h3>
                <button class="close-btn" onclick="closeEditFormulaModal()">&times;</button>
            </div>
            <form id="editFormulaForm" onsubmit="saveFormulaEdit(event)">
                <input type="hidden" id="editFormulaSeries">
                <input type="hidden" id="editFormulaIndex">
                <div class="form-group">
                    <label>Component Name</label>
                    <input type="text" id="editFormulaComponent" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="editFormulaDesc" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantity Formula</label>
                        <input type="text" id="editFormulaQty" required>
                    </div>
                    <div class="form-group">
                        <label>Length Formula</label>
                        <input type="text" id="editFormulaLength" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">üíæ Save Changes</button>
                <button type="button" class="btn btn-danger" onclick="closeEditFormulaModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- JavaScript Files - Load in Order -->
    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>
    <script src="js/optimization.js"></script>
    <script src="js/exports.js"></script>
    <script src="js/quotation.js"></script>

</body>

</html>